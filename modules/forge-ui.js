/* ============================================================
   SpawnEngine Forge UI v3.1
   Mesh Forge â€“ item crafting & module synthesis system
   ============================================================ */

import { getInventory, simulateSynthesis } from "../api/pack-actions.js";

/* â€”â€” Elements â€”â€” */
const forgePanel = document.getElementById("forgePanel");
const synthBtn = document.getElementById("forgeSynthBtn");
const forgeLog = document.getElementById("forgeLog");
const invReadout = document.getElementById("forgeInventory");

/* â€”â€” Helpers â€”â€” */
function updateForgeInventory() {
  const inv = getInventory();
  if (invReadout) {
    invReadout.innerHTML = `
      ğŸ”¹ Fragments: ${inv.fragments} <br>
      ğŸ”¸ Shards: ${inv.shards} <br>
      ğŸª„ Relics: ${inv.relics}
    `;
  }
}

function logForge(msg) {
  const el = document.createElement("div");
  el.className = "forge-msg";
  el.textContent = msg;
  forgeLog.appendChild(el);
  forgeLog.scrollTop = forgeLog.scrollHeight;
}

/* â€”â€” Core Action â€”â€” */
function handleSynthesis() {
  const result = simulateSynthesis();
  logForge(result.message);
  updateForgeInventory();
  showToast(result.success ? "Relic successfully forged!" : "Forge failed!");
}

/* â€”â€” Toast UI â€”â€” */
function showToast(message) {
  const toast = document.createElement("div");
  toast.textContent = message;
  toast.style = `
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: #4df2ff;
    color: #000;
    padding: 8px 14px;
    border-radius: 8px;
    font-weight: 600;
    font-family: system-ui, sans-serif;
    z-index: 9999;
    box-shadow: 0 0 12px rgba(77,242,255,0.5);
  `;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 2500);
}

/* â€”â€” Init â€”â€” */
window.addEventListener("DOMContentLoaded", () => {
  if (!forgePanel) return;
  updateForgeInventory();
  synthBtn.addEventListener("click", handleSynthesis);
  logForge("âš™ï¸ Forge ready. Combine Fragments & Shards to mint Relics.");
});