/* ============================================================
   SPAWNENGINE Â· Forge Terminal v1.0
   Developer Console for Mesh Commands
   ============================================================ */
import { XPPulse } from "./xp-pulse.js";

window.addEventListener("DOMContentLoaded", () => {
  const term = document.getElementById("forgeTerminal");
  if (!term) return;

  const output = document.createElement("div");
  output.className = "terminal-output";
  term.appendChild(output);

  const inputWrap = document.createElement("div");
  inputWrap.className = "terminal-input";
  inputWrap.innerHTML = `<span class="prompt">mesh&gt;</span>
    <input type="text" id="terminalCmd" placeholder="Type command..." autocomplete="off" />`;
  term.appendChild(inputWrap);

  const input = inputWrap.querySelector("#terminalCmd");

  const logLine = (text, cls = "line") => {
    const line = document.createElement("div");
    line.className = cls;
    line.textContent = text;
    output.appendChild(line);
    output.scrollTop = output.scrollHeight;
  };

  const commands = {
    help() {
      logLine("Available commands:", "cmd");
      logLine("help â€” Show this list");
      logLine("mint â€” Simulate mint pack");
      logLine("xp â€” Show XP stats");
      logLine("pulse â€” Trigger XP visual pulse");
      logLine("clear â€” Clear terminal");
    },
    mint() {
      logLine("Minting mock pack...");
      setTimeout(() => {
        logLine("âœ… Pack minted successfully.", "cmd");
        XPPulse.trigger(window.innerWidth / 2, window.innerHeight / 2, "#3cf6ff");
      }, 600);
    },
    xp() {
      const xp = Math.floor(Math.random() * 5000) + 1000;
      logLine(`XP Balance: ${xp}`, "cmd");
    },
    pulse() {
      logLine("ðŸ’  Triggering XP Pulse...", "cmd");
      XPPulse.trigger(window.innerWidth / 2, window.innerHeight / 2, "#b9ff7a");
    },
    clear() {
      output.innerHTML = "";
    },
  };

  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      const cmd = input.value.trim().toLowerCase();
      if (!cmd) return;
      logLine(`> ${cmd}`, "line cmd");
      if (commands[cmd]) {
        commands[cmd]();
      } else {
        logLine(`Unknown command: ${cmd}`, "line error");
      }
      input.value = "";
    }
  });

  logLine("ðŸ§¬ Forge Terminal Ready. Type 'help' for commands.", "cmd");
});